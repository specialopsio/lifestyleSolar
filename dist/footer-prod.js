!function(){if(-1!==window.location.href.indexOf("lifestylesolar.com")){let s,d,n=void document.addEventListener("DOMContentLoaded",function(){function t(){clearError(),e=setInterval(function(){r+=10;var o=document.getElementById("dynamic"),l=document.getElementById("current-progress");o&&(o.style.width=r+"%",o.setAttribute("aria-valuenow",r),l.textContent=r<=25?"Searching address":r<=50?"Analyzing roof":r<=75?"Measuring sunlight":"Getting quote",100<=r)&&(clearInterval(e),setTimeout(function(){var e=document.getElementById("formAddress"),t=document.getElementById("quote1"),n=document.getElementById("quote2"),a=document.getElementById("quote3");selectedPlaceCTA||e&&""!==e.value.trim()?(n&&(n.style.display="none"),a&&(a.style.display="block"),s=!0,d&&(m(),f())):(t&&(t.style.display="block"),n&&(n.style.display="none"),a&&(a.style.display="none"),o&&(o.style.width="0%",o.setAttribute("aria-valuenow",0),l.textContent=""),r=0,displayError("Please input your addrress."))},250))},500)}var e,n,a,r=0,o=(window.location.hash&&(n=document.getElementById("quote1"),a=document.getElementById("quote2"),n&&(n.style.display="none"),a)&&(a.style.display="block",t()),document.getElementById("quote2")),l=(new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"style"===e.attributeName&&"block"===o.style.display&&t()})}).observe(o,{attributes:!0}),document.getElementById("quote1"));new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"style"===e.attributeName&&"none"===l.style.display&&o&&(o.style.display="block")})}).observe(l,{attributes:!0})}),y=null;let r=["00000A","91009C","E64616","FEB400","FFFFF6"];const v=["E8EAF6","1A237E"];let u=[],i,c;async function m(){var e,t,n,a,o=(new Date).getTime(),l=(document.getElementById("gmap_canvas"),document.getElementById("userFrontHouse"));l.src=y.icon_url+"&time="+o,l.srcset=y.icon_url+"&time="+o,document.getElementById("userAddress").textContent=y.home_address+" in "+y.city,document.getElementById("sunlightHours").textContent=y.sunlight_hours,document.getElementById("roofSize").textContent=y.roof_area,document.getElementById("savingsDollars").textContent=y.year_twenty_savings,document.getElementById("formAddress").value=y.display_address,document.getElementById("bill").value=y.bill,document.querySelectorAll('[id="billValue"]').forEach(function(e){e.textContent="$"+y.bill}),document.getElementById("array_area").value=y.array_area,document.getElementById("formStreet").value=y.home_address,document.getElementById("formCity").value=y.city,document.getElementById("formStateShort").value=y.state,document.getElementById("formZip").value=y.zip,document.getElementById("formStateLong").value=y.stateLong,document.getElementById("roof_area").value=y.roof_area,document.getElementById("max_panels").value=y.max_panels,document.getElementById("wattage").value=y.wattage,document.getElementById("sunlight_hours").value=y.sunlight_hours,document.getElementById("lat").value=y.lat,document.getElementById("lon").value=y.lon,document.getElementById("carbon_offset").value=y.carbon_offset,c=function(e,t,n){const a=new google.maps.LatLng(e,t),o={center:a,zoom:20,tilt:0,mapTypeId:"satellite",mapTypeControl:!1,fullscreenControl:!1,rotateControl:!1,streetViewControl:!1,zoomControl:!1},l=document.getElementById(n),r=new google.maps.Map(l,o);return r.addListener("zoom_changed",function(){console.debug("Map",r.getZoom()),r.getZoom()<18&&r.setZoom(18)}),r}(y.lat,y.lon,"map_container"),y.geoTiff&&({fluxData:o,maskData:l}=await async function(e,t){try{var n=await g(t),a=await g(e);return{maskData:n,fluxData:a}}catch(e){console.error("Fetching TIFFs failed",e)}}((l=y.geoTiff).flux,l.mask),console.debug("maskdata",l),n=l.width,a=l.height,e=Math.floor(n/2),t=Math.floor(a/2),a=function(e,n,a){let o=1/0,l=null;return e.forEach(e=>{var t=function(e){let t=0,n=0;return e.forEach(e=>{t+=e.x,n+=e.y}),{x:t/e.length,y:n/e.length}}(e),t=Math.sqrt(Math.pow(t.x-n,2)+Math.pow(t.y-a,2));t<o&&(o=t,l=e)}),l}(function(n,a,o){const l=[],r=new Set;for(let t=0;t<o;t++)for(let e=0;e<a;e++){var s=t*a+e;1!==n[s]||r.has(s)||(s=function(e,t,n,a,o){var l=new Set,r=[{x:t,y:n}],s=[];for(;0<r.length;){var{x:d,y:u}=r.shift(),i=u*a+d;if(!l.has(i)&&0!==e[i]){l.add(i),s.push({x:d,y:u});for(const m of function(n,a,o,l){var r=[];for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++){var s,d;0===t&&0===e||(s=n+t,d=a+e,0<=s&&s<o&&0<=d&&d<l&&r.push({x:s,y:d}))}return r}(d,u,a,o)){var c=m.y*a+m.x;l.has(c)||1!==e[c]||r.push(m)}}}return s}(n,e,t,a,o),l.push(s),s.forEach(e=>r.add(e.y*a+e.x)))}return l}(l.rasters[0],n,a),e,t),l.rasters[0]=function(e,t,n){const a=new Array(e.length).fill(0);return n.forEach(e=>{e=e.y*t+e.x;a[e]=1}),a}(l.rasters[0],n,a),e=function(n,a,e,o,l){var r=document.createElement("canvas"),t=(r.width=a.width,r.height=a.height,r.getContext("2d")),s=t.createImageData(r.width,r.height),d=E(e);for(let t=0;t<r.height;t++)for(let e=0;e<r.width;e++){var u=t*r.width+e,i=I(n.rasters[0][u],o,l),i=255<Math.round(i*(d.length-1))?255:Math.round(i*(d.length-1)),i=d[i];s.data[4*u+0]=i.r,s.data[4*u+1]=i.g,s.data[4*u+2]=i.b,s.data[4*u+3]=a.rasters[0][u]?255:0}return t.putImageData(s,0,0),r}(o,l,r,0,1800),t=e,n=o.bounds,a=c,t=t.toDataURL(),(t=new google.maps.GroundOverlay(t,n)).setMap(a),i=y.solar_potential,async function(e){u.forEach(e=>e.setMap(null));const l=i,r=(E(v,256),l.solarPanels[l.solarPanels.length-1].yearlyEnergyDcKwh),s=l.solarPanels[0].yearlyEnergyDcKwh,t=(u=l.solarPanels.map(n=>{var[e,t]=[l.panelWidthMeters/2,l.panelHeightMeters/2],e=[{x:+e,y:+t},{x:+e,y:-t},{x:-e,y:-t},{x:-e,y:+t},{x:+e,y:+t}];const a="PORTRAIT"===n.orientation?90:0,o=l.roofSegmentStats[n.segmentIndex].azimuthDegrees;Math.round(255*I(n.yearlyEnergyDcKwh,s,r));return new google.maps.Polygon({paths:e.map(({x:e,y:t})=>google.maps.geometry.spherical.computeOffset(new google.maps.LatLng(n.center.latitude,n.center.longitude),Math.sqrt(e*e+t*t),Math.atan2(t,e)*(180/Math.PI)+a+o)),strokeColor:"#B0BEC5",strokeOpacity:.9,strokeWeight:1,fillColor:"#0f0f0f",fillOpacity:.9})}),Math.ceil((u.length-1)/4));h(e,4<t?t:3)}(c),document.getElementById("solarPanelSlider").max=i.solarPanelConfigs[i.solarPanelConfigs.length-1].panelsCount,document.getElementById("solarPanelSlider").min=i.solarPanelConfigs[0].panelsCount,document.getElementById("solarPanelSlider").value=i.solarPanelConfigs[i.solarPanelConfigs.length-1].panelsCount/4,document.getElementById("solarPanelSlider").addEventListener("input",e=>{e=parseInt(e.target.value,10);h(c,e-1)}),(l=document.getElementById("solarPanelSliderContainer")).style.display="flex",c.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(l))}async function g(e){try{var t=await fetch(e);if(200!==t.status)throw new Error("Failed to download GeoTIFF from url:",e);var n=await t.arrayBuffer(),a=await(await GeoTIFF.fromArrayBuffer(n)).getImage(),o=await a.readRasters(),l=(u=y.lat,i=y.lon,c=30,m=(c/=1e3)/6371,c=Math.asin(c/(6371*Math.cos(Math.PI*u/180))),g=u+180*m/Math.PI,u-=180*m/Math.PI,m=i+180*c/Math.PI,i-=180*c/Math.PI,{north:g,south:u,east:m,west:i}),r=a.getGeoKeys(),s=a.getBoundingBox(),d=proj4(r.ProjLinearUnitsGeoKey||"WGS84");d.forward({x:s[0],y:s[1]}),d.forward({x:s[2],y:s[3]});return{width:a.getWidth(),height:a.getHeight(),rasters:o,bounds:l}}catch(e){throw console.error("Error processing GeoTIFF:",e),e}var u,i,c,m,g}function h(t,n){u.forEach(e=>e.setMap(null));for(let e=0;e<=n;e++)u[e].setMap(t);var e=document.getElementById("sliderValue");e.innerText=n+1,e.value=n;let a=i.solarPanelConfigs.findIndex(e=>e.panelsCount>=n);-1===a&&(a=i.solarPanelConfigs.length-1);e=i.solarPanelConfigs[a];i.panelCapacityWatts;e.panelsCount;let o=.85*+e.yearlyEnergyDcKwh;e=[...Array(20).keys()].map(e=>o*.995**e).map((e,t)=>Math.max(.13*(300/.13*12-e)*1.022**t/1.04**t,0)).reduce((e,t)=>e+t,0),e=Array.from({length:20},(e,t)=>3600*Math.pow(1.022,t)/Math.pow(1.04,t)).reduce((e,t)=>e+t,0)-(e-7e3);document.getElementById("savingsDollars").textContent="$"+e.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function f(){document.getElementById("quote3").style.display="block",document.getElementById("quote2").style.display="none"}google.maps.event.addDomListener(window,"load",function(){document.querySelectorAll(".address-input").forEach(function(e){var t=new google.maps.places.Autocomplete(e);t.addListener("place_changed",function(){var e;n=t.getPlace(),(e=document.getElementById("calculateButton")).classList.contains("disabled")&&n&&e.classList.remove("disabled")})})});const t=new URLSearchParams(window.location.search);function a(e){e=e.startsWith("#")?e.slice(1):e;return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function p(e,t,n){return e+n*(t-e)}function E(e,t=256){const o=e.map(a),l=(o.length-1)/(t-1);return Array.from({length:t},(e,t)=>{var t=t*l,n=Math.floor(t),a=Math.ceil(t);return{r:p(o[n].r,o[a].r,t-n),g:p(o[n].g,o[a].g,t-n),b:p(o[n].b,o[a].b,t-n)}})}function I(e,t,n){return(e-t)/(n-t)}function e(t,n,a=2e3){return new Promise(e=>{setTimeout(()=>{document.getElementById(t).textContent=n,document.getElementById("skeleton-"+t).remove(),e()},a)})}document.addEventListener("DOMContentLoaded",function(){if("true"===new URLSearchParams(window.location.search).get("commercial"))document.getElementById("commercial").style.display="block",document.getElementById("modal").style.display="none",document.getElementById("app").style.display="none";else if(t.has("hash"))try{document.getElementById("quote1").style.display="none";var e=t.get("hash");fetch("https://vj61befm45.execute-api.us-east-1.amazonaws.com/default/solar_hash?data_hash="+e,{method:"GET"}).then(e=>e.json()).then(e=>{e.lat&&(d=!0,y=e,document.getElementById("formAddress").value=y.display_address,s)&&(m(),f())})}catch(e){console.debug("ERROR",e)}}),["sunlightHours","kwHours","savingsDollars"].forEach(e=>{var t,n,a=document.getElementById(e),e=(e="skeleton-"+e,t="skeleton-rectangle",(n=document.createElement("div")).id=e,n.className="skeleton "+t,n);a.parentElement.insertBefore(e,a)}),Promise.all([e("sunlightHours","2,187"),e("kwHours","4kw"),e("savingsDollars","$8,000")]).then(()=>{})}}();